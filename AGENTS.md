# AGENTS.md - Codex専用指示

Codexは小規模実装を担当する。
**必ず RULES.md を先に読むこと。**

---

## 役割

- 承認済み設計に基づく小規模実装
- 機械的・再現的なコード生成
- 明確に指示された範囲のみ実装

---

## 許可される作業

- UI (`ui/`) の軽微な修正
- **フロントエンド（`frontend/`）の全般的な変更**
  - Next.jsコンポーネントの追加・修正
  - UIスタイルの変更
  - 状態管理（Zustand）の変更
  - API呼び出し（`frontend/src/lib/api.ts`）の変更
- 新規ユーティリティ関数の追加（`core/` 以外）
- ドキュメント更新
- テストコード追加

---

## 禁止事項

### 絶対禁止

- 既存APIのシグネチャ変更
- ファイル削除
- 依頼範囲外の「改善」

### 条件付き禁止

以下は **明示的な許可がある場合のみ** 可：
- `core/` ディレクトリ内のファイル変更（許可があった場合は変更する）
- 3ファイル以上の同時変更
- データ構造の変更
- 新規依存ライブラリの追加

### geometry_v4 ファイルの使い分け（重要）

| ファイル | 用途 | 編集可否 |
|----------|------|----------|
| `geometry_v4_frontend.py` | **本番用** - Next.jsが使用 | **こちらを編集** |
| `geometry_v4.py` | 開発用 - Streamlit等で使用 | **編集しない** |

**メッシュ生成の修正は必ず `geometry_v4_frontend.py` を編集すること。**
`geometry_v4.py` を編集しても本番環境には反映されない。

---

## 判断基準

| 状況 | 対応 |
|------|------|
| 指示が明確 | 実装する |
| 指示が曖昧 | 実装せず確認を求める |
| `core/` に触れる必要がある | 許可がある場合は実装する。許可がない場合は確認を求める |
| 大規模になりそう | Claude Codeに引き継ぐ |

---

## 実装前チェックリスト

1. [ ] RULES.md を確認したか
2. [ ] 変更対象は `core/` 以外か、または `core/` 変更の明示的な許可があるか
3. [ ] バックエンドのコアロジックを変更する場合は許可がある１1
4. [ ] 依頼された範囲内か
5. [ ] 3ファイル以内の変更か（フロントエンドは例外あり）

**フロントエンド開発時の特別チェック：**
- [ ] `core/` ディレクトリに触れる場合は明示的な許可があるか
- [ ] `backend/api/endpoints.py` の既存エンドポイントシグネチャを変更していないか
- [ ] コアエンジン関数の呼び出し方法を変更する場合は許可があるか

**許可がない場合は、実装せず計画を提示すること。許可がある場合は実装すること。**

---

## 参照

- **RULES.md**: AI共通ルール（必読）
- **CLAUDE.md**: 大規模作業はClaude Codeが担当

---

## Codex運用メモ（ユーザー指定）

- 「UIを開く」は通常UI（`frontend/` の Next.js、`http://localhost:3000`）を指す
- 開発用UI（`ui/app.py` の Streamlit、`http://localhost:8501`）は「開発用を開く」の明示時のみ
- UIを開く際は、同時にバックエンド（`python backend/main.py`、ポート `8001`）も起動する
